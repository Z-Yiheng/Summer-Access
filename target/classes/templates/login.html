<!DOCTYPE html>
<head lang="en" xmlns:th="http://www.thymeleaf.org">
    <meta charset="UTF-8">
    <title>后台管理登录界面</title>
    <link rel="stylesheet" href="/CSS/login.css" th:href="@{/CSS/login.css}">
    <link rel="stylesheet" href="/Utils/semantic_ui/semantic.css" th:href="@{/Utils/semantic_ui/semantic.css}">
</head>

<body>
    <div class="wrap">
        <div class="container">
            <h1 class="ui icon header" style="display: inline; color: white;">
                <i class="settings icon"></i>
                <div class="content">后台管理
                    <div class="sub header">WELCOME BACK</div>
                </div>
            </h1>
            <div id="form-1" method="post" th:action="@{/login}" enctype="application/json">
                <div>
                    <input type="text" name="username" id="username" placeholder="user login" />
                </div>
                <div>
                    <input type="password" name="password" id="password" placeholder="password" />
                </div>
                <input type="submit" name="submit" id="submit-btn" onclick="login()" value="Login" />
            </div>
            <div class="ui negative message" th:if="${not #strings.isEmpty(msg)}">
                <i class="close icon"></i>
                <div class="header">对不起，您没有权限</div>
                <p>可能权限过期，请重新登录</p>
            </div>
        </div>
        <div class="ui dimmer" id="load">
            <div class="ui text loader">Loading</div>
        </div>
        <ul>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <div class="ui basic modal">
            <div class="ui icon header">
                <i class="x icon"></i>
                密码或账号错误
            </div>
            <div class="actions">
                <div class="ui green ok inverted button">
                    <i class="checkmark icon"></i>
                    OK
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="/Utils/jquery-3.6.0.js" th:src="@{/Utils/jquery-3.6.0.js}"></script>
    <script src="/Utils/semantic_ui/semantic.min.js" th:src="@{/Utils/semantic_ui/semantic.min.js}"></script>
    <script>
        function login() {
            var username = $('#username').val();
            var password = $('#password').val();

            var user = JSON.stringify({
                "username": username,
                "password": password
            });

            $.ajax({
                url: "/login",
                type: 'POST',
                contentType: 'application/json',
                data: user,
                dataType: 'json',
                beforeSend: function () {
                    $('#load').attr("class","ui active dimmer")
                },
                success: function(data) {
                    if (data.result == "fail") {
                        $('.ui.basic.modal')
                            .modal('show')
                        ;
                    } else {
                        window.location.href = "/personal";
                    }
                },
                complete: function () {
                    $('#load').attr("class","ui dimmer")
                }
            })
        }

        $('.message .close')
            .on('click', function() {
                $(this)
                    .closest('.message')
                    .transition('fade')
                ;
            })
        ;
    </script>
</body>

</html>